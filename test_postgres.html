<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>WebGIS Example with Leaflet</title>
    <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
    <style>
        #map {
            height: 500px;
            width: 100%;
        }
        #queryInput {
            margin: 10px 0;
        }
    </style>
</head>
<body>

    <h3>WebGIS Example with Leaflet</h3>
    <input type="text" id="queryInput" placeholder="Enter query (e.g., materijal='pehd')" />
    <button onclick="applyQuery()">Apply Query</button>

    <div id="map"></div>

    <script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
    <script>
        // Inicijalizacija mape
        var map = L.map('map').setView([45.815399, 15.966568], 13); // Centrirano na Zagreb, HR

        // Dodavanje tile layera
        L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
            maxZoom: 18,
        }).addTo(map);

        // Definicija cijevi sa atributima
        var pipes = [
            {
                coordinates: [[45.815, 15.965], [45.816, 15.966]],
                attributes: { profil: 63, materijal: 'pehd' }
            },
            {
                coordinates: [[45.816, 15.967], [45.817, 15.968]],
                attributes: { profil: 100, materijal: 'ce' }
            },
            {
                coordinates: [[45.817, 15.969], [45.818, 15.970]],
                attributes: { profil: 250, materijal: 'nl' }
            },
            {
                coordinates: [[45.818, 15.971], [45.819, 15.972]],
                attributes: { profil: 200, materijal: 'pvc' }
            },
            {
                coordinates: [[45.819, 15.973], [45.820, 15.974]],
                attributes: { profil: 300, materijal: 'ac' }
            }
        ];

        var pipeLayers = [];

        // Funkcija za prikaz cijevi na mapi
        function showPipes(pipes) {
            // Prvo uklonimo sve slojeve
            pipeLayers.forEach(layer => map.removeLayer(layer));
            pipeLayers = [];

            // Dodavanje slojeva za svaku cijev
            pipes.forEach(pipe => {
                var line = L.polyline(pipe.coordinates, { color: 'blue' }).addTo(map);
                line.bindPopup(`Profil: ${pipe.attributes.profil}, Materijal: ${pipe.attributes.materijal}`);
                pipeLayers.push(line);
            });
        }

        // Prikaz svih cijevi pri pokretanju
        showPipes(pipes);

        // Funkcija za primjenu upita
        function applyQuery() {
            var query = document.getElementById('queryInput').value.trim();
            var filteredPipes = pipes;

            // Filtriraj prema materijalu
            if (query.startsWith("materijal=")) {
                var material = query.split("=")[1].replace(/['"]/g, '');
                filteredPipes = pipes.filter(pipe => pipe.attributes.materijal.toLowerCase() === material.toLowerCase());
            }

            // Filtriraj prema profilu
            else if (query.startsWith("profil=")) {
                var profil = parseInt(query.split("=")[1]);
                filteredPipes = pipes.filter(pipe => pipe.attributes.profil === profil);
            }

            // Prika≈æi filtrirane cijevi
            showPipes(filteredPipes);
        }
    </script>
</body>
</html>
